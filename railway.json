{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "NIXPACKS"
  },
  "deploy": {
    "numReplicas": 1,
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10
  },
  "services": [
    {
      "name": "backend",
      "source": {
        "repo": "IbrahimAyad/medusajs-2.0-for-railway-kct",
        "branch": "main"
      },
      "build": {
        "buildCommand": "cd backend && pnpm install && pnpm build",
        "watchPatterns": [
          "backend/**"
        ]
      },
      "deploy": {
        "startCommand": "cd backend && ./start.sh",
        "healthcheckPath": "/health",
        "healthcheckTimeout": 300
      },
      "envVars": {
        "NODE_ENV": "production",
        "PORT": "9000"
      }
    },
    {
      "name": "storefront",
      "source": {
        "repo": "IbrahimAyad/medusajs-2.0-for-railway-kct",
        "branch": "main"
      },
      "build": {
        "buildCommand": "cd storefront && pnpm install && pnpm build",
        "watchPatterns": [
          "storefront/**"
        ]
      },
      "deploy": {
        "startCommand": "cd storefront && pnpm start",
        "healthcheckPath": "/",
        "healthcheckTimeout": 300
      },
      "envVars": {
        "NODE_ENV": "production",
        "NEXT_PUBLIC_MEDUSA_PUBLISHABLE_KEY": "${{MEDUSA_PUBLISHABLE_KEY}}",
        "NEXT_PUBLIC_MEDUSA_BACKEND_URL": "${{RAILWAY_BACKEND_URL}}",
        "NEXT_PUBLIC_BASE_URL": "${{RAILWAY_PUBLIC_DOMAIN}}"
      }
    }
  ]
}